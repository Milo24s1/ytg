<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>YTGallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">


    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.9/css/mdb.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

</head>
<body>
<nav class="navbar navbar-dark ">
    <a class="navbar-brand" href="/">
        <div class="logo">YTGallery</div>
    </a>
</nav>
<div class="flex-center flex-column">

    <div id="loader" class="loader invisible center-block"></div>
    <form id="eventForm" method="post">
        <div class="md-form mt-3">
            <label class="active" for="eventName">Event Name</label>
            <input type="text" id="eventName" class="form-control" required>

        </div>
        <div class="md-form mt-3">
            <label class="active" for="year">Year</label>
            <input type="text" id="year" class="form-control" required>
        </div>
        <button id="addEvent" class="btn btn-success">Add Event</button>
    </form>
</div>

<div id="tableDiv" class="row">
    <div class="col-1"></div>
    <div class="col-10">
        <table class="table">
            <thead class="white-text">
            <tr>
                <th scope="col">Event</th>
                <th scope="col">Year</th>
                <th scope="col"></th>
                <th scope="col"></th>
                <th scope="col"></th>
            </tr>
            </thead>
            <tbody>
            <% for(var i=0; i < itms.length; i++) { %>
            <tr>
                <th class="col-3" scope="row"><a href="/event/<%= itms[i]._id %>"><%= itms[i].eventName %></a></th>
                <td class="col-5 text-truncate"><%= itms[i].year %></td>
                <td class="col-2"><a title="Delete Event" data-tid="<%= itms[i]._id %>" href="/deleteEvent/<%= itms[i]._id %>" class="btn btn-sm btn-danger">Delete</a></td>
                <td class="col-1"><a title="Add New URL" data-toggle="modal" data-target="#addUrl"><i class="fa fa-youtube fa-2x cyan-text pr-3" data-eventId="<%= itms[i]._id %>" aria-hidden="true"></i></a></td>
                <td class="col-1"><a title="Manage Event URL List" data-toggle="modal" data-target="#viewUrls"><i class="fa fa-cog fa-2x purple-text pr-3" data-eventId="<%= itms[i]._id %>" aria-hidden="true"></i></a></td>
            </tr>
            <% } %>
            </tbody>
        </table>
    </div>
    <div class="col-1"></div>
</div>
<div style="height: 30vh">
</div>


<div class="modal fade" id="addUrl" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog  modal-notify modal-danger "  role="document" >
        <!--Content-->
        <div class="modal-content">
            <!--Header-->
            <div class="modal-header">
                <p class="heading lead font-weight-bold">Add New Video</p>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" class="white-text">×</span>
                </button>
            </div>

            <!--Body-->
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa fa-check fa-4x mb-3 animated rotateIn"></i>
                </div>

                <form class="needs-validation" novalidate>
                    <div class="md-form">
                        <i class="fa fa-youtube prefix"></i>
                        <input type="text" id="inputIconEx1" class="form-control" value="" required>
                        <label for="inputIconEx1">Video URL</label>
                    </div>
                </form>
                <!--<p class="font-weight-bold" id="addAnotherVideo"><i class="fa fa-youtube cyan-text" aria-hidden="true"></i>&nbsp;Add Another Video </p>-->
            </div>

            <!--Footer-->
            <div class="modal-footer">
                <a type="button" id="addEventVideo" class="btn btn-success waves-effect waves-light">Save
                </a>
                <a type="button" class="btn btn-outline-success waves-effect" data-dismiss="modal">Cancel</a>
            </div>
        </div>
        <!--/.Content-->
    </div>
</div>

<div class="modal fade" id="viewUrls" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog  modal-notify modal-info "  role="document" >
        <!--Content-->
        <div class="modal-content">
            <!--Header-->
            <div class="modal-header">
                <p class="heading lead font-weight-bold">Event Video List</p>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" class="white-text">×</span>
                </button>
            </div>

            <!--Body-->
            <div class="modal-body ">
                <div class="list-group">
                </div>
                <div id="modalLoader" class="flex-center flex-column loader invisible center-block"></div>
            </div>

            <!--Footer-->
            <div class="modal-footer">
                <a type="button" id="saveReportConfig" class="btn btn-danger  waves-effect waves-light">Delete
                </a>
                <a type="button" class="btn btn-outline-danger waves-effect" data-dismiss="modal">Cancel</a>
            </div>
        </div>
        <!--/.Content-->
    </div>
</div>

<!-- Footer -->
<footer class="page-footer font-small ">

    <!-- Copyright -->
    <div class="footer-copyright text-center py-3">© 2018 Copyright:
        <a href="/"> YTGallery.com</a>
    </div>
    <!-- Copyright -->

</footer>
<!-- Footer -->

<!-- JQuery -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.9/js/mdb.min.js"></script>
<script>

    $(document).ready(function () {

        var currentEventId = null;


        $("#addEvent").click(function (e) {

            $("#loader").removeClass('invisible');
            e.preventDefault();

            $.ajax({
                url : '/addEvent',
                data: {
                    eventName : $('#eventName').val(),
                    year : $('#year').val()
                },
                method: 'post',
                dataType: 'json',
                success: function (data) {
                    alert('Event Saved');
                    $("#loader").addClass('invisible');
                    document.querySelector('form').reset();
                    window.location = '/admin';

                },
                error : function (xhr, ajaxOptions, thrownError) {

                    if(xhr.status!=200) {
                        alert('Something went wrong with adding token, pleas refresh the page and try again');
                    }
                    document.querySelector('form').reset();
                    $("#loader").addClass('invisible');
                }
            });
        });

        $(".fa-youtube").click(function (e) {

            currentEventId = $(this).data('eventid');
            $("#inputIconEx1").val('');
        });

        $("#addEventVideo").click(function (e) {

            var tempUrl = $("#inputIconEx1").val();
            document.querySelector('[data-dismiss="modal"]').click();
            document.querySelector('form').reset();
            $.ajax({
                url: '/addEventVideo',
                method: 'post',
                dataType: 'json',
                data: {
                    eventId : currentEventId,
                    url: tempUrl,
                },
                success: function (data) {
                    $("#loader").addClass('invisible');
                    alert('Added Successfully')

                },
                error: function (xhr, ajaxOptions, thrownError) {
                    if(xhr.status!=200) {
                        $("#loader").addClass('invisible');
                        alert('Something went wrong with Adding URL, pleas refresh the page and try again');
                    }
                }
            });


        });



        $(".fa-cog").click(function (e) {
            $('.list-group').addClass('preloader');
            $(".list-group")[0].innerHTML = '';
            currentEventId = $(this).data('eventid');

            $.ajax({
                url: '/getEventVideo',
                method: 'POST',
                dataType: 'json',
                data: {
                    eventId : currentEventId,
                },
                success: function (data) {
                    $("#modalLoader").addClass('invisible');

                    var listDom = ``;
                    if(data.length>0){

                        for (i=0;i<data.length;i++){
                            listDom += `<div class="custom-list-item custom-control custom-checkbox  font-weight-bold">
                        <input data-eventvideoid= ${data[i]._id} type="checkbox" class="custom-control-input" id="${data[i]._id}">
                        <label class="custom-control-label" for="${data[i]._id}" style="margin-left: 22px">${data[i].url}</label>
                    </div>`;
                        }
                    }

                    $(".list-group").append(listDom);
                    $(document).on('click', '.custom-control-input', function(){
                        var currentState = $(this).prop('checked');
                        if(currentState==true){
                            $(this).prop('checked',true);
                        }
                        else {
                            $(this).prop('checked',false);
                        }

                    });

                    $('.list-group').removeClass('preloader');

                },
                error: function (xhr, ajaxOptions, thrownError) {
                    if(xhr.status!=200) {
                        $("#modalLoader").addClass('invisible');
                        alert('Something went wrong with Loading URL, pleas refresh the page and try again');
                    }
                }

            });
        });

    });




</script>
<style>

    .preloader {
        position: fixed;
        left: 0;
        top: 0;
        z-index: 999;
        width: 100%;
        height: 100%;
        overflow: visible;
        background: #333 url('http://files.mimoymima.com/images/loading.gif') no-repeat center center;
    }
    .loader {
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    #tableDiv{
        margin-top: 40px;
    }
    .custom-list-item{
        border: 1px solid rgba(0, 0, 0,.125);
        padding: .75rem 1.25rem;
        margin-bottom: -1px;
    }


</style>
</body>
</html>